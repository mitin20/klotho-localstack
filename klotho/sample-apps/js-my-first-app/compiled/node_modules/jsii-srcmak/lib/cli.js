"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const yargs = __importStar(require("yargs"));
const srcmak_1 = require("./srcmak");
async function main() {
    const args = yargs
        .usage('$0 SRCDIR [OPTIONS]')
        .option('entrypoint', { desc: 'typescript entrypoint (relative to SRCDIR)', default: 'index.ts' })
        .option('dep', { desc: 'node module directories to include in compilation', type: 'array', string: true })
        .option('jsii-path', { desc: 'write .jsii output to this path', type: 'string' })
        .option('python-outdir', { desc: 'python output directory (requires --python-module-name)', type: 'string' })
        .option('python-module-name', { desc: 'python module name', type: 'string' })
        .option('java-outdir', { desc: 'java output directory (requires --java-package)', type: 'string' })
        .option('java-package', { desc: 'the java package (namespace) to use for all generated types', type: 'string' })
        .option('csharp-outdir', { desc: 'C# output directory (requires --csharp-namespace)', type: 'string' })
        .option('csharp-namespace', { desc: 'the C# namespace to use for all generated types', type: 'string' })
        .option('golang-outdir', { desc: 'golang output directory (requires --golang-module)', type: 'string' })
        .option('golang-module', { desc: 'the golang module to use for all generated types', type: 'string' })
        .option('golang-package', { desc: 'the golang package name to use for all generated types', type: 'string' })
        .showHelpOnFail(true)
        .help();
    const argv = args.argv;
    if (argv._.length !== 1) {
        args.showHelp();
        console.error();
        console.error('Invalid number of arguments. expecting a single positional argument.');
        process.exit(1);
    }
    const srcdir = argv._[0];
    await (0, srcmak_1.srcmak)(srcdir, {
        entrypoint: argv.entrypoint,
        ...parseDepOption(),
        ...parseJsiiOptions(),
        ...parsePythonOptions(),
        ...parseJavaOptions(),
        ...parseCSharpOptions(),
        ...parseGoLangOptions(),
    });
    function parseJsiiOptions() {
        const jsiiPath = argv['jsii-path'];
        if (!jsiiPath) {
            return undefined;
        }
        return {
            jsii: {
                path: jsiiPath,
            },
        };
    }
    function parsePythonOptions() {
        const outdir = argv['python-outdir'];
        const moduleName = argv['python-module-name'];
        if (!outdir && !moduleName) {
            return undefined;
        }
        if (!outdir) {
            throw new Error('--python-outdir is required if --python-module-name is specified');
        }
        if (!moduleName) {
            throw new Error('--python-module-name is required if --python-outdir is specified');
        }
        return {
            python: {
                outdir: outdir,
                moduleName: moduleName,
            },
        };
    }
    function parseJavaOptions() {
        const outdir = argv['java-outdir'];
        const packageName = argv['java-package'];
        if (!outdir && !packageName) {
            return undefined;
        }
        if (!outdir) {
            throw new Error('--java-outdir is required');
        }
        if (!packageName) {
            throw new Error('--java-package is required');
        }
        return {
            java: {
                outdir: outdir,
                package: packageName,
            },
        };
    }
    function parseCSharpOptions() {
        const outdir = argv['csharp-outdir'];
        const namespace = argv['csharp-namespace'];
        if (!outdir && !namespace) {
            return undefined;
        }
        if (!outdir) {
            throw new Error('--csharp-outdir is required');
        }
        if (!namespace) {
            throw new Error('--csharp-namespace is required');
        }
        return {
            csharp: {
                outdir: outdir,
                namespace: namespace,
            },
        };
    }
    function parseGoLangOptions() {
        const outdir = argv['golang-outdir'];
        const module = argv['golang-module'];
        const packageName = argv['golang-package'];
        if (!outdir && !module) {
            return undefined;
        }
        if (!outdir) {
            throw new Error('--golang-outdir is required');
        }
        if (!module) {
            throw new Error('--golang-module is required');
        }
        if (!packageName) {
            throw new Error('--golang-package is required');
        }
        return {
            golang: {
                outdir: outdir,
                moduleName: module,
                packageName: packageName,
            },
        };
    }
    function parseDepOption() {
        var _a;
        if (((_a = argv.dep) === null || _a === void 0 ? void 0 : _a.length) === 0) {
            return undefined;
        }
        return {
            deps: argv.dep,
        };
    }
}
main().catch((e) => {
    console.error(e.stack);
    process.exit(1);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQStCO0FBQy9CLHFDQUFrQztBQUVsQyxLQUFLLFVBQVUsSUFBSTtJQUNqQixNQUFNLElBQUksR0FBRyxLQUFLO1NBQ2YsS0FBSyxDQUFDLHFCQUFxQixDQUFDO1NBQzVCLE1BQU0sQ0FBQyxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsNENBQTRDLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxDQUFDO1NBQ2pHLE1BQU0sQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsbURBQW1ELEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7U0FDekcsTUFBTSxDQUFDLFdBQVcsRUFBRSxFQUFFLElBQUksRUFBRSxpQ0FBaUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUM7U0FDaEYsTUFBTSxDQUFDLGVBQWUsRUFBRSxFQUFFLElBQUksRUFBRSx5REFBeUQsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUM7U0FDNUcsTUFBTSxDQUFDLG9CQUFvQixFQUFFLEVBQUUsSUFBSSxFQUFFLG9CQUFvQixFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztTQUM1RSxNQUFNLENBQUMsYUFBYSxFQUFFLEVBQUUsSUFBSSxFQUFFLGlEQUFpRCxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztTQUNsRyxNQUFNLENBQUMsY0FBYyxFQUFFLEVBQUUsSUFBSSxFQUFFLDZEQUE2RCxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztTQUMvRyxNQUFNLENBQUMsZUFBZSxFQUFFLEVBQUUsSUFBSSxFQUFFLG1EQUFtRCxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztTQUN0RyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxJ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LDhCQUE4QixDQUFDLENBQUM7U0FBRTtRQUN0RSxPQUFPO1lBQ0wsTUFBTSxFQUFFO2dCQUNOLE1BQU0sRUFBRSxNQUFNO2dCQUNkLFVBQVUsRUFBRSxNQUFNO2dCQUNsQixXQUFXLEVBQUUsV0FBVzthQUN6QjtTQUNGLENBQUM7SUFDSixDQUFDO0lBRUQsU0FBUyxjQUFjOztRQUNyQixJQUFJLENBQUEsTUFBQSxJQUFJLENBQUMsR0FBRywwQ0FBRSxNQUFNLE1BQUssQ0FBQyxFQUFFO1lBQUUsT0FBTyxTQUFTLENBQUM7U0FBRTtRQUNqRCxPQUFPO1lBQ0wsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHO1NBQ2YsQ0FBQztJQUNKLENBQUM7QUFDSCxDQUFDO0FBRUQsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBUSxFQUFFLEVBQUU7SUFDeEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkIsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNsQixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHlhcmdzIGZyb20gJ3lhcmdzJztcbmltcG9ydCB7IHNyY21hayB9IGZyb20gJy4vc3JjbWFrJztcblxuYXN5bmMgZnVuY3Rpb24gbWFpbigpIHtcbiAgY29uc3QgYXJncyA9IHlhcmdzXG4gICAgLnVzYWdlKCckMCBTUkNESVIgW09QVElPTlNdJylcbiAgICAub3B0aW9uKCdlbnRyeXBvaW50JywgeyBkZXNjOiAndHlwZXNjcmlwdCBlbnRyeXBvaW50IChyZWxhdGl2ZSB0byBTUkNESVIpJywgZGVmYXVsdDogJ2luZGV4LnRzJyB9KVxuICAgIC5vcHRpb24oJ2RlcCcsIHsgZGVzYzogJ25vZGUgbW9kdWxlIGRpcmVjdG9yaWVzIHRvIGluY2x1ZGUgaW4gY29tcGlsYXRpb24nLCB0eXBlOiAnYXJyYXknLCBzdHJpbmc6IHRydWUgfSlcbiAgICAub3B0aW9uKCdqc2lpLXBhdGgnLCB7IGRlc2M6ICd3cml0ZSAuanNpaSBvdXRwdXQgdG8gdGhpcyBwYXRoJywgdHlwZTogJ3N0cmluZycgfSlcbiAgICAub3B0aW9uKCdweXRob24tb3V0ZGlyJywgeyBkZXNjOiAncHl0aG9uIG91dHB1dCBkaXJlY3RvcnkgKHJlcXVpcmVzIC0tcHl0aG9uLW1vZHVsZS1uYW1lKScsIHR5cGU6ICdzdHJpbmcnIH0pXG4gICAgLm9wdGlvbigncHl0aG9uLW1vZHVsZS1uYW1lJywgeyBkZXNjOiAncHl0aG9uIG1vZHVsZSBuYW1lJywgdHlwZTogJ3N0cmluZycgfSlcbiAgICAub3B0aW9uKCdqYXZhLW91dGRpcicsIHsgZGVzYzogJ2phdmEgb3V0cHV0IGRpcmVjdG9yeSAocmVxdWlyZXMgLS1qYXZhLXBhY2thZ2UpJywgdHlwZTogJ3N0cmluZycgfSlcbiAgICAub3B0aW9uKCdqYXZhLXBhY2thZ2UnLCB7IGRlc2M6ICd0aGUgamF2YSBwYWNrYWdlIChuYW1lc3BhY2UpIHRvIHVzZSBmb3IgYWxsIGdlbmVyYXRlZCB0eXBlcycsIHR5cGU6ICdzdHJpbmcnIH0pXG4gICAgLm9wdGlvbignY3NoYXJwLW91dGRpcicsIHsgZGVzYzogJ0MjIG91dHB1dCBkaXJlY3RvcnkgKHJlcXVpcmVzIC0tY3NoYXJwLW5hbWVzcGFjZSknLCB0eXBlOiAnc3RyaW5nJyB9KVxuICAgIC5vcHRpb24oJ2NzaGFycC1uYW1lc3BhY2UnLCB7IGRlc2M6ICd0aGUgQyMgbmFtZXNwYWNlIHRvIHVzZSBmb3IgYWxsIGdlbmVyYXRlZCB0eXBlcycsIHR5cGU6ICdzdHJpbmcnIH0pXG4gICAgLm9wdGlvbignZ29sYW5nLW91dGRpcicsIHsgZGVzYzogJ2dvbGFuZyBvdXRwdXQgZGlyZWN0b3J5IChyZXF1aXJlcyAtLWdvbGFuZy1tb2R1bGUpJywgdHlwZTogJ3N0cmluZycgfSlcbiAgICAub3B0aW9uKCdnb2xhbmctbW9kdWxlJywgeyBkZXNjOiAndGhlIGdvbGFuZyBtb2R1bGUgdG8gdXNlIGZvciBhbGwgZ2VuZXJhdGVkIHR5cGVzJywgdHlwZTogJ3N0cmluZycgfSlcbiAgICAub3B0aW9uKCdnb2xhbmctcGFja2FnZScsIHsgZGVzYzogJ3RoZSBnb2xhbmcgcGFja2FnZSBuYW1lIHRvIHVzZSBmb3IgYWxsIGdlbmVyYXRlZCB0eXBlcycsIHR5cGU6ICdzdHJpbmcnIH0pXG4gICAgLnNob3dIZWxwT25GYWlsKHRydWUpXG4gICAgLmhlbHAoKTtcblxuICBjb25zdCBhcmd2ID0gYXJncy5hcmd2O1xuXG4gIGlmIChhcmd2Ll8ubGVuZ3RoICE9PSAxKSB7XG4gICAgYXJncy5zaG93SGVscCgpO1xuICAgIGNvbnNvbGUuZXJyb3IoKTtcbiAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIG51bWJlciBvZiBhcmd1bWVudHMuIGV4cGVjdGluZyBhIHNpbmdsZSBwb3NpdGlvbmFsIGFyZ3VtZW50LicpO1xuICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgfVxuXG4gIGNvbnN0IHNyY2RpciA9IGFyZ3YuX1swXSBhcyBzdHJpbmc7XG4gIGF3YWl0IHNyY21hayhzcmNkaXIsIHtcbiAgICBlbnRyeXBvaW50OiBhcmd2LmVudHJ5cG9pbnQsXG4gICAgLi4ucGFyc2VEZXBPcHRpb24oKSxcbiAgICAuLi5wYXJzZUpzaWlPcHRpb25zKCksXG4gICAgLi4ucGFyc2VQeXRob25PcHRpb25zKCksXG4gICAgLi4ucGFyc2VKYXZhT3B0aW9ucygpLFxuICAgIC4uLnBhcnNlQ1NoYXJwT3B0aW9ucygpLFxuICAgIC4uLnBhcnNlR29MYW5nT3B0aW9ucygpLFxuICB9KTtcblxuICBmdW5jdGlvbiBwYXJzZUpzaWlPcHRpb25zKCkge1xuICAgIGNvbnN0IGpzaWlQYXRoID0gYXJndlsnanNpaS1wYXRoJ107XG4gICAgaWYgKCFqc2lpUGF0aCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGpzaWk6IHtcbiAgICAgICAgcGF0aDoganNpaVBhdGgsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBwYXJzZVB5dGhvbk9wdGlvbnMoKSB7XG4gICAgY29uc3Qgb3V0ZGlyID0gYXJndlsncHl0aG9uLW91dGRpciddO1xuICAgIGNvbnN0IG1vZHVsZU5hbWUgPSBhcmd2WydweXRob24tbW9kdWxlLW5hbWUnXTtcbiAgICBpZiAoIW91dGRpciAmJiAhbW9kdWxlTmFtZSkgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG4gICAgaWYgKCFvdXRkaXIpIHsgdGhyb3cgbmV3IEVycm9yKCctLXB5dGhvbi1vdXRkaXIgaXMgcmVxdWlyZWQgaWYgLS1weXRob24tbW9kdWxlLW5hbWUgaXMgc3BlY2lmaWVkJyk7IH1cbiAgICBpZiAoIW1vZHVsZU5hbWUpIHsgdGhyb3cgbmV3IEVycm9yKCctLXB5dGhvbi1tb2R1bGUtbmFtZSBpcyByZXF1aXJlZCBpZiAtLXB5dGhvbi1vdXRkaXIgaXMgc3BlY2lmaWVkJyk7IH1cbiAgICByZXR1cm4ge1xuICAgICAgcHl0aG9uOiB7XG4gICAgICAgIG91dGRpcjogb3V0ZGlyLFxuICAgICAgICBtb2R1bGVOYW1lOiBtb2R1bGVOYW1lLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VKYXZhT3B0aW9ucygpIHtcbiAgICBjb25zdCBvdXRkaXIgPSBhcmd2WydqYXZhLW91dGRpciddO1xuICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gYXJndlsnamF2YS1wYWNrYWdlJ107XG4gICAgaWYgKCFvdXRkaXIgJiYgIXBhY2thZ2VOYW1lKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cbiAgICBpZiAoIW91dGRpcikgeyB0aHJvdyBuZXcgRXJyb3IoJy0tamF2YS1vdXRkaXIgaXMgcmVxdWlyZWQnKTsgfVxuICAgIGlmICghcGFja2FnZU5hbWUpIHsgdGhyb3cgbmV3IEVycm9yKCctLWphdmEtcGFja2FnZSBpcyByZXF1aXJlZCcpOyB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGphdmE6IHtcbiAgICAgICAgb3V0ZGlyOiBvdXRkaXIsXG4gICAgICAgIHBhY2thZ2U6IHBhY2thZ2VOYW1lLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gcGFyc2VDU2hhcnBPcHRpb25zKCkge1xuICAgIGNvbnN0IG91dGRpciA9IGFyZ3ZbJ2NzaGFycC1vdXRkaXInXTtcbiAgICBjb25zdCBuYW1lc3BhY2UgPSBhcmd2Wydjc2hhcnAtbmFtZXNwYWNlJ107XG4gICAgaWYgKCFvdXRkaXIgJiYgIW5hbWVzcGFjZSkgeyByZXR1cm4gdW5kZWZpbmVkOyB9XG4gICAgaWYgKCFvdXRkaXIpIHsgdGhyb3cgbmV3IEVycm9yKCctLWNzaGFycC1vdXRkaXIgaXMgcmVxdWlyZWQnKTsgfVxuICAgIGlmICghbmFtZXNwYWNlKSB7IHRocm93IG5ldyBFcnJvcignLS1jc2hhcnAtbmFtZXNwYWNlIGlzIHJlcXVpcmVkJyk7IH1cbiAgICByZXR1cm4ge1xuICAgICAgY3NoYXJwOiB7XG4gICAgICAgIG91dGRpcjogb3V0ZGlyLFxuICAgICAgICBuYW1lc3BhY2U6IG5hbWVzcGFjZSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlR29MYW5nT3B0aW9ucygpIHtcbiAgICBjb25zdCBvdXRkaXIgPSBhcmd2Wydnb2xhbmctb3V0ZGlyJ107XG4gICAgY29uc3QgbW9kdWxlID0gYXJndlsnZ29sYW5nLW1vZHVsZSddO1xuICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gYXJndlsnZ29sYW5nLXBhY2thZ2UnXTtcbiAgICBpZiAoIW91dGRpciAmJiAhbW9kdWxlKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cbiAgICBpZiAoIW91dGRpcikgeyB0aHJvdyBuZXcgRXJyb3IoJy0tZ29sYW5nLW91dGRpciBpcyByZXF1aXJlZCcpOyB9XG4gICAgaWYgKCFtb2R1bGUpIHsgdGhyb3cgbmV3IEVycm9yKCctLWdvbGFuZy1tb2R1bGUgaXMgcmVxdWlyZWQnKTsgfVxuICAgIGlmICghcGFja2FnZU5hbWUpIHsgdGhyb3cgbmV3IEVycm9yKCctLWdvbGFuZy1wYWNrYWdlIGlzIHJlcXVpcmVkJyk7IH1cbiAgICByZXR1cm4ge1xuICAgICAgZ29sYW5nOiB7XG4gICAgICAgIG91dGRpcjogb3V0ZGlyLFxuICAgICAgICBtb2R1bGVOYW1lOiBtb2R1bGUsXG4gICAgICAgIHBhY2thZ2VOYW1lOiBwYWNrYWdlTmFtZSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhcnNlRGVwT3B0aW9uKCkge1xuICAgIGlmIChhcmd2LmRlcD8ubGVuZ3RoID09PSAwKSB7IHJldHVybiB1bmRlZmluZWQ7IH1cbiAgICByZXR1cm4ge1xuICAgICAgZGVwczogYXJndi5kZXAsXG4gICAgfTtcbiAgfVxufVxuXG5tYWluKCkuY2F0Y2goKGU6IEVycm9yKSA9PiB7XG4gIGNvbnNvbGUuZXJyb3IoZS5zdGFjayk7XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn0pO1xuXG4iXX0=
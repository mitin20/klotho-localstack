"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const path = __importStar(require("path"));
const fs = __importStar(require("fs-extra"));
const pacmak = __importStar(require("jsii-pacmak"));
const pacmakv = __importStar(require("jsii-pacmak/lib/targets/version-utils"));
const sscaff_1 = require("sscaff");
const pkgroot = path.join(__dirname, '..', '..', '..');
const pkg = fs.readJsonSync(path.join(pkgroot, 'package.json'));
const constructsVersion = pkg.dependencies.constructs.replace('^', '');
const templatesDir = path.join(pkgroot, 'templates');
const availableTemplates = fs.readdirSync(templatesDir).filter(x => !x.startsWith('.'));
class Command {
    constructor() {
        this.command = 'init TYPE';
        this.describe = 'Create a new cdk8s project from a template.';
        this.builder = (args) => args
            .positional('TYPE', { demandOption: true, desc: 'Project type' })
            .showHelpOnFail(false)
            .choices('TYPE', availableTemplates);
    }
    async handler(argv) {
        var _a, _b;
        if (fs.readdirSync('.').filter(f => !f.startsWith('.')).length > 0) {
            console.error('Cannot initialize a project in a non-empty directory');
            process.exit(1);
        }
        console.error(`Initializing a project from the ${argv.type} template`);
        const templatePath = path.join(templatesDir, argv.type);
        const deps = await determineDeps();
        try {
            await (0, sscaff_1.sscaff)(templatePath, '.', deps);
        }
        catch (er) {
            const e = er;
            throw new Error(`error during project initialization: ${e.stack}\nSTDOUT:\n${(_a = e.stdout) === null || _a === void 0 ? void 0 : _a.toString()}\nSTDERR:\n${(_b = e.stderr) === null || _b === void 0 ? void 0 : _b.toString()}`);
        }
    }
}
async function determineDeps() {
    var _a;
    const cdk8s = new ModuleVersion('cdk8s', { jsii: true });
    const cdk8sPlus = new ModuleVersion('cdk8s-plus-25', { jsii: true });
    const cdk8sCli = new ModuleVersion('cdk8s-cli');
    const jsii = new ModuleVersion('jsii');
    return {
        npm_cdk8s: cdk8s.npmDependency,
        npm_cdk8s_plus: cdk8sPlus.npmDependency,
        pypi_cdk8s: cdk8s.pypiDependency,
        pypi_cdk8s_plus: cdk8sPlus.pypiDependency,
        mvn_cdk8s: cdk8s.mavenDependency,
        mvn_cdk8s_plus: cdk8sPlus.mavenDependency,
        cdk8s_core_version: cdk8s.version,
        cdk8s_plus_version: cdk8sPlus.version,
        constructs_version: constructsVersion,
        jsii_version: jsii.version,
        // when running tests, install the tarball created from our source
        npm_cdk8s_cli: (_a = process.env.CDK8S_TARBALL) !== null && _a !== void 0 ? _a : cdk8sCli.npmDependency,
    };
}
class ModuleVersion {
    constructor(moduleName, options = {}) {
        var _a;
        this.moduleName = moduleName;
        this.version = this.resolveVersion(moduleName);
        this.npmVersion = this.version;
        this.pypiVersion = pacmakv.toReleaseVersion(this.version, pacmak.TargetName.PYTHON);
        this.mavenVersion = pacmakv.toReleaseVersion(this.version, pacmak.TargetName.JAVA);
        this.jsii = (_a = options.jsii) !== null && _a !== void 0 ? _a : false;
    }
    get npmTarballFile() {
        if (this.jsii) {
            return `${this.moduleName}@${this.version}.jsii.tgz`;
        }
        else {
            return `${this.moduleName}-v${this.version}.tgz`;
        }
    }
    get pypiWheelFile() {
        const [major, minor, patch, pre] = this.pypiVersion.split('.');
        return `${this.moduleName.replace(/-/g, '_')}-${major}.${minor}.${patch}${pre !== null && pre !== void 0 ? pre : ''}-py3-none-any.whl`;
    }
    get javaJarFile() {
        return `org/cdk8s/${this.moduleName}/${this.mavenVersion}/${this.moduleName}-${this.mavenVersion}.jar`;
    }
    get npmDependency() {
        return `${this.moduleName}@^${this.npmVersion}`;
    }
    get pypiDependency() {
        return `${this.moduleName}~=${this.pypiVersion}`;
    }
    get mavenDependency() {
        return this.mavenVersion;
    }
    resolveVersion(module) {
        if (module === 'cdk8s-cli') {
            module = '../../../';
        }
        // eslint-disable-next-line @typescript-eslint/no-require-imports
        return require(`${module}/package.json`).version;
    }
}
module.exports = new Command();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5pdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jbGkvY21kcy9pbml0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBNkI7QUFDN0IsNkNBQStCO0FBQy9CLG9EQUFzQztBQUN0QywrRUFBaUU7QUFDakUsbUNBQWdDO0FBR2hDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFFdkQsTUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDO0FBQ2hFLE1BQU0saUJBQWlCLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUV2RSxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQztBQUNyRCxNQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFFeEYsTUFBTSxPQUFPO0lBQWI7UUFDa0IsWUFBTyxHQUFHLFdBQVcsQ0FBQztRQUN0QixhQUFRLEdBQUcsNkNBQTZDLENBQUM7UUFDekQsWUFBTyxHQUFHLENBQUMsSUFBZ0IsRUFBRSxFQUFFLENBQUMsSUFBSTthQUNqRCxVQUFVLENBQUMsTUFBTSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLENBQUM7YUFDaEUsY0FBYyxDQUFDLEtBQUssQ0FBQzthQUNyQixPQUFPLENBQUMsTUFBTSxFQUFFLGtCQUFrQixDQUFDLENBQUM7SUFtQnpDLENBQUM7SUFqQlEsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFTOztRQUM1QixJQUFJLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNsRSxPQUFPLENBQUMsS0FBSyxDQUFDLHNEQUFzRCxDQUFDLENBQUM7WUFDdEUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNqQjtRQUVELE9BQU8sQ0FBQyxLQUFLLENBQUMsbUNBQW1DLElBQUksQ0FBQyxJQUFJLFdBQVcsQ0FBQyxDQUFDO1FBQ3ZFLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RCxNQUFNLElBQUksR0FBUSxNQUFNLGFBQWEsRUFBRSxDQUFDO1FBRXhDLElBQUk7WUFDRixNQUFNLElBQUEsZUFBTSxFQUFDLFlBQVksRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDdkM7UUFBQyxPQUFPLEVBQUUsRUFBRTtZQUNYLE1BQU0sQ0FBQyxHQUFHLEVBQVMsQ0FBQztZQUNwQixNQUFNLElBQUksS0FBSyxDQUFDLHdDQUF3QyxDQUFDLENBQUMsS0FBSyxjQUFjLE1BQUEsQ0FBQyxDQUFDLE1BQU0sMENBQUUsUUFBUSxFQUFFLGNBQWMsTUFBQSxDQUFDLENBQUMsTUFBTSwwQ0FBRSxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7U0FDeEk7SUFDSCxDQUFDO0NBQ0Y7QUFFRCxLQUFLLFVBQVUsYUFBYTs7SUFDMUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxhQUFhLENBQUMsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDekQsTUFBTSxTQUFTLEdBQUcsSUFBSSxhQUFhLENBQUMsZUFBZSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDckUsTUFBTSxRQUFRLEdBQUcsSUFBSSxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDaEQsTUFBTSxJQUFJLEdBQUcsSUFBSSxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFdkMsT0FBTztRQUNMLFNBQVMsRUFBRSxLQUFLLENBQUMsYUFBYTtRQUM5QixjQUFjLEVBQUUsU0FBUyxDQUFDLGFBQWE7UUFDdkMsVUFBVSxFQUFFLEtBQUssQ0FBQyxjQUFjO1FBQ2hDLGVBQWUsRUFBRSxTQUFTLENBQUMsY0FBYztRQUN6QyxTQUFTLEVBQUUsS0FBSyxDQUFDLGVBQWU7UUFDaEMsY0FBYyxFQUFFLFNBQVMsQ0FBQyxlQUFlO1FBQ3pDLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxPQUFPO1FBQ2pDLGtCQUFrQixFQUFFLFNBQVMsQ0FBQyxPQUFPO1FBQ3JDLGtCQUFrQixFQUFFLGlCQUFpQjtRQUNyQyxZQUFZLEVBQUUsSUFBSSxDQUFDLE9BQU87UUFFMUIsa0VBQWtFO1FBQ2xFLGFBQWEsRUFBRSxNQUFBLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxtQ0FBSSxRQUFRLENBQUMsYUFBYTtLQUNuRSxDQUFDO0FBQ0osQ0FBQztBQWdCRCxNQUFNLGFBQWE7SUFRakIsWUFBNkIsVUFBa0IsRUFBRSxVQUE4QixFQUFHOztRQUFyRCxlQUFVLEdBQVYsVUFBVSxDQUFRO1FBQzdDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDL0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BGLElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuRixJQUFJLENBQUMsSUFBSSxHQUFHLE1BQUEsT0FBTyxDQUFDLElBQUksbUNBQUksS0FBSyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxJQUFXLGNBQWM7UUFDdkIsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2IsT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLE9BQU8sV0FBVyxDQUFDO1NBQ3REO2FBQU07WUFDTCxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsS0FBSyxJQUFJLENBQUMsT0FBTyxNQUFNLENBQUM7U0FDbEQ7SUFDSCxDQUFDO0lBRUQsSUFBVyxhQUFhO1FBQ3RCLE1BQU0sQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvRCxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxLQUFLLElBQUksS0FBSyxHQUFHLEdBQUcsYUFBSCxHQUFHLGNBQUgsR0FBRyxHQUFJLEVBQUUsbUJBQW1CLENBQUM7SUFDekcsQ0FBQztJQUVELElBQVcsV0FBVztRQUNwQixPQUFPLGFBQWEsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFlBQVksTUFBTSxDQUFDO0lBQ3pHLENBQUM7SUFFRCxJQUFXLGFBQWE7UUFDdEIsT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLEtBQUssSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ2xELENBQUM7SUFFRCxJQUFXLGNBQWM7UUFDdkIsT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLEtBQUssSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ25ELENBQUM7SUFFRCxJQUFXLGVBQWU7UUFDeEIsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzNCLENBQUM7SUFFTyxjQUFjLENBQUMsTUFBYztRQUNuQyxJQUFJLE1BQU0sS0FBSyxXQUFXLEVBQUU7WUFDMUIsTUFBTSxHQUFHLFdBQVcsQ0FBQztTQUN0QjtRQUVELGlFQUFpRTtRQUNqRSxPQUFPLE9BQU8sQ0FBQyxHQUFHLE1BQU0sZUFBZSxDQUFDLENBQUMsT0FBTyxDQUFDO0lBQ25ELENBQUM7Q0FDRjtBQUdELE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgKiBhcyBwYWNtYWsgZnJvbSAnanNpaS1wYWNtYWsnO1xuaW1wb3J0ICogYXMgcGFjbWFrdiBmcm9tICdqc2lpLXBhY21hay9saWIvdGFyZ2V0cy92ZXJzaW9uLXV0aWxzJztcbmltcG9ydCB7IHNzY2FmZiB9IGZyb20gJ3NzY2FmZic7XG5pbXBvcnQgKiBhcyB5YXJncyBmcm9tICd5YXJncyc7XG5cbmNvbnN0IHBrZ3Jvb3QgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnLi4nKTtcblxuY29uc3QgcGtnID0gZnMucmVhZEpzb25TeW5jKHBhdGguam9pbihwa2dyb290LCAncGFja2FnZS5qc29uJykpO1xuY29uc3QgY29uc3RydWN0c1ZlcnNpb24gPSBwa2cuZGVwZW5kZW5jaWVzLmNvbnN0cnVjdHMucmVwbGFjZSgnXicsICcnKTtcblxuY29uc3QgdGVtcGxhdGVzRGlyID0gcGF0aC5qb2luKHBrZ3Jvb3QsICd0ZW1wbGF0ZXMnKTtcbmNvbnN0IGF2YWlsYWJsZVRlbXBsYXRlcyA9IGZzLnJlYWRkaXJTeW5jKHRlbXBsYXRlc0RpcikuZmlsdGVyKHggPT4gIXguc3RhcnRzV2l0aCgnLicpKTtcblxuY2xhc3MgQ29tbWFuZCBpbXBsZW1lbnRzIHlhcmdzLkNvbW1hbmRNb2R1bGUge1xuICBwdWJsaWMgcmVhZG9ubHkgY29tbWFuZCA9ICdpbml0IFRZUEUnO1xuICBwdWJsaWMgcmVhZG9ubHkgZGVzY3JpYmUgPSAnQ3JlYXRlIGEgbmV3IGNkazhzIHByb2plY3QgZnJvbSBhIHRlbXBsYXRlLic7XG4gIHB1YmxpYyByZWFkb25seSBidWlsZGVyID0gKGFyZ3M6IHlhcmdzLkFyZ3YpID0+IGFyZ3NcbiAgICAucG9zaXRpb25hbCgnVFlQRScsIHsgZGVtYW5kT3B0aW9uOiB0cnVlLCBkZXNjOiAnUHJvamVjdCB0eXBlJyB9KVxuICAgIC5zaG93SGVscE9uRmFpbChmYWxzZSlcbiAgICAuY2hvaWNlcygnVFlQRScsIGF2YWlsYWJsZVRlbXBsYXRlcyk7XG5cbiAgcHVibGljIGFzeW5jIGhhbmRsZXIoYXJndjogYW55KSB7XG4gICAgaWYgKGZzLnJlYWRkaXJTeW5jKCcuJykuZmlsdGVyKGYgPT4gIWYuc3RhcnRzV2l0aCgnLicpKS5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdDYW5ub3QgaW5pdGlhbGl6ZSBhIHByb2plY3QgaW4gYSBub24tZW1wdHkgZGlyZWN0b3J5Jyk7XG4gICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgfVxuXG4gICAgY29uc29sZS5lcnJvcihgSW5pdGlhbGl6aW5nIGEgcHJvamVjdCBmcm9tIHRoZSAke2FyZ3YudHlwZX0gdGVtcGxhdGVgKTtcbiAgICBjb25zdCB0ZW1wbGF0ZVBhdGggPSBwYXRoLmpvaW4odGVtcGxhdGVzRGlyLCBhcmd2LnR5cGUpO1xuICAgIGNvbnN0IGRlcHM6IGFueSA9IGF3YWl0IGRldGVybWluZURlcHMoKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzc2NhZmYodGVtcGxhdGVQYXRoLCAnLicsIGRlcHMpO1xuICAgIH0gY2F0Y2ggKGVyKSB7XG4gICAgICBjb25zdCBlID0gZXIgYXMgYW55O1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBlcnJvciBkdXJpbmcgcHJvamVjdCBpbml0aWFsaXphdGlvbjogJHtlLnN0YWNrfVxcblNURE9VVDpcXG4ke2Uuc3Rkb3V0Py50b1N0cmluZygpfVxcblNUREVSUjpcXG4ke2Uuc3RkZXJyPy50b1N0cmluZygpfWApO1xuICAgIH1cbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBkZXRlcm1pbmVEZXBzKCk6IFByb21pc2U8RGVwcz4ge1xuICBjb25zdCBjZGs4cyA9IG5ldyBNb2R1bGVWZXJzaW9uKCdjZGs4cycsIHsganNpaTogdHJ1ZSB9KTtcbiAgY29uc3QgY2RrOHNQbHVzID0gbmV3IE1vZHVsZVZlcnNpb24oJ2NkazhzLXBsdXMtMjUnLCB7IGpzaWk6IHRydWUgfSk7XG4gIGNvbnN0IGNkazhzQ2xpID0gbmV3IE1vZHVsZVZlcnNpb24oJ2NkazhzLWNsaScpO1xuICBjb25zdCBqc2lpID0gbmV3IE1vZHVsZVZlcnNpb24oJ2pzaWknKTtcblxuICByZXR1cm4ge1xuICAgIG5wbV9jZGs4czogY2RrOHMubnBtRGVwZW5kZW5jeSxcbiAgICBucG1fY2RrOHNfcGx1czogY2RrOHNQbHVzLm5wbURlcGVuZGVuY3ksXG4gICAgcHlwaV9jZGs4czogY2RrOHMucHlwaURlcGVuZGVuY3ksXG4gICAgcHlwaV9jZGs4c19wbHVzOiBjZGs4c1BsdXMucHlwaURlcGVuZGVuY3ksXG4gICAgbXZuX2NkazhzOiBjZGs4cy5tYXZlbkRlcGVuZGVuY3ksXG4gICAgbXZuX2NkazhzX3BsdXM6IGNkazhzUGx1cy5tYXZlbkRlcGVuZGVuY3ksXG4gICAgY2RrOHNfY29yZV92ZXJzaW9uOiBjZGs4cy52ZXJzaW9uLFxuICAgIGNkazhzX3BsdXNfdmVyc2lvbjogY2RrOHNQbHVzLnZlcnNpb24sXG4gICAgY29uc3RydWN0c192ZXJzaW9uOiBjb25zdHJ1Y3RzVmVyc2lvbixcbiAgICBqc2lpX3ZlcnNpb246IGpzaWkudmVyc2lvbixcblxuICAgIC8vIHdoZW4gcnVubmluZyB0ZXN0cywgaW5zdGFsbCB0aGUgdGFyYmFsbCBjcmVhdGVkIGZyb20gb3VyIHNvdXJjZVxuICAgIG5wbV9jZGs4c19jbGk6IHByb2Nlc3MuZW52LkNESzhTX1RBUkJBTEwgPz8gY2RrOHNDbGkubnBtRGVwZW5kZW5jeSxcbiAgfTtcbn1cblxuaW50ZXJmYWNlIERlcHMge1xuICBucG1fY2RrOHM6IHN0cmluZztcbiAgbnBtX2NkazhzX2NsaT86IHN0cmluZztcbiAgbnBtX2NkazhzX3BsdXM6IHN0cmluZztcbiAgcHlwaV9jZGs4czogc3RyaW5nO1xuICBweXBpX2NkazhzX3BsdXM6IHN0cmluZztcbiAgbXZuX2NkazhzOiBzdHJpbmc7XG4gIG12bl9jZGs4c19wbHVzOiBzdHJpbmc7XG4gIGNkazhzX2NvcmVfdmVyc2lvbjogc3RyaW5nO1xuICBjZGs4c19wbHVzX3ZlcnNpb246IHN0cmluZztcbiAgY29uc3RydWN0c192ZXJzaW9uOiBzdHJpbmc7XG4gIGpzaWlfdmVyc2lvbjogc3RyaW5nO1xufVxuXG5jbGFzcyBNb2R1bGVWZXJzaW9uIHtcbiAgcHVibGljIHJlYWRvbmx5IHB5cGlWZXJzaW9uOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBucG1WZXJzaW9uOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBtYXZlblZlcnNpb246IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IHZlcnNpb246IHN0cmluZztcblxuICBwcml2YXRlIHJlYWRvbmx5IGpzaWk6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBtb2R1bGVOYW1lOiBzdHJpbmcsIG9wdGlvbnM6IHsganNpaT86IGJvb2xlYW4gfSA9IHsgfSkge1xuICAgIHRoaXMudmVyc2lvbiA9IHRoaXMucmVzb2x2ZVZlcnNpb24obW9kdWxlTmFtZSk7XG4gICAgdGhpcy5ucG1WZXJzaW9uID0gdGhpcy52ZXJzaW9uO1xuICAgIHRoaXMucHlwaVZlcnNpb24gPSBwYWNtYWt2LnRvUmVsZWFzZVZlcnNpb24odGhpcy52ZXJzaW9uLCBwYWNtYWsuVGFyZ2V0TmFtZS5QWVRIT04pO1xuICAgIHRoaXMubWF2ZW5WZXJzaW9uID0gcGFjbWFrdi50b1JlbGVhc2VWZXJzaW9uKHRoaXMudmVyc2lvbiwgcGFjbWFrLlRhcmdldE5hbWUuSkFWQSk7XG4gICAgdGhpcy5qc2lpID0gb3B0aW9ucy5qc2lpID8/IGZhbHNlO1xuICB9XG5cbiAgcHVibGljIGdldCBucG1UYXJiYWxsRmlsZSgpIHtcbiAgICBpZiAodGhpcy5qc2lpKSB7XG4gICAgICByZXR1cm4gYCR7dGhpcy5tb2R1bGVOYW1lfUAke3RoaXMudmVyc2lvbn0uanNpaS50Z3pgO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYCR7dGhpcy5tb2R1bGVOYW1lfS12JHt0aGlzLnZlcnNpb259LnRnemA7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldCBweXBpV2hlZWxGaWxlKCkge1xuICAgIGNvbnN0IFttYWpvciwgbWlub3IsIHBhdGNoLCBwcmVdID0gdGhpcy5weXBpVmVyc2lvbi5zcGxpdCgnLicpO1xuICAgIHJldHVybiBgJHt0aGlzLm1vZHVsZU5hbWUucmVwbGFjZSgvLS9nLCAnXycpfS0ke21ham9yfS4ke21pbm9yfS4ke3BhdGNofSR7cHJlID8/ICcnfS1weTMtbm9uZS1hbnkud2hsYDtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgamF2YUphckZpbGUoKSB7XG4gICAgcmV0dXJuIGBvcmcvY2RrOHMvJHt0aGlzLm1vZHVsZU5hbWV9LyR7dGhpcy5tYXZlblZlcnNpb259LyR7dGhpcy5tb2R1bGVOYW1lfS0ke3RoaXMubWF2ZW5WZXJzaW9ufS5qYXJgO1xuICB9XG5cbiAgcHVibGljIGdldCBucG1EZXBlbmRlbmN5KCkge1xuICAgIHJldHVybiBgJHt0aGlzLm1vZHVsZU5hbWV9QF4ke3RoaXMubnBtVmVyc2lvbn1gO1xuICB9XG5cbiAgcHVibGljIGdldCBweXBpRGVwZW5kZW5jeSgpIHtcbiAgICByZXR1cm4gYCR7dGhpcy5tb2R1bGVOYW1lfX49JHt0aGlzLnB5cGlWZXJzaW9ufWA7XG4gIH1cblxuICBwdWJsaWMgZ2V0IG1hdmVuRGVwZW5kZW5jeSgpIHtcbiAgICByZXR1cm4gdGhpcy5tYXZlblZlcnNpb247XG4gIH1cblxuICBwcml2YXRlIHJlc29sdmVWZXJzaW9uKG1vZHVsZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAobW9kdWxlID09PSAnY2RrOHMtY2xpJykge1xuICAgICAgbW9kdWxlID0gJy4uLy4uLy4uLyc7XG4gICAgfVxuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1yZXF1aXJlLWltcG9ydHNcbiAgICByZXR1cm4gcmVxdWlyZShgJHttb2R1bGV9L3BhY2thZ2UuanNvbmApLnZlcnNpb247XG4gIH1cbn1cblxuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBDb21tYW5kKCk7XG4iXX0=